<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Table View</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1 style="text-align: center;">Dynamic Table View</h1>

    <!-- Dropdown to select table -->
    <div style="text-align: center; margin: 20px;">
        <label for="table-select">Choose a table:</label>
        <select id="table-select">
            <option value="app_downloads">App Downloads</option>
            <option value="signups">Signups</option>
            <option value="ride_requests">Ride Requests</option>
            <option value="transactions">Transactions</option>
        </select>
        <button id="load-table-btn">Load Table</button>
    </div>

    <!-- Placeholder for the table -->
    <div id="table-container" style="width: 90%; margin: auto;"></div>

    <script>
        // Handle button click
        $('#load-table-btn').click(function () {
            const tableName = $('#table-select').val();

            // Send AJAX request to load data
            $.ajax({
                url: '/dashboard/load_data',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({ table_name: tableName }),
                success: function (response) {
                    if (response.data) {
                        renderTable(response.data, `Table: ${tableName}`);
                    } else if (response.error) {
                        alert(`Error: ${response.error}`);
                    }
                },
                error: function (err) {
                    alert('Failed to load data. Please try again.');
                }
            });
        });

        // Function to render table with Plotly
        function renderTable(data, title) {
            if (!data || data.length === 0) {
                alert('No data available for this table.');
                return;
            }

            const columns = Object.keys(data[0]);
            const values = columns.map(col => data.map(row => row[col]));

            const fig = {
                data: [{
                    type: 'table',
                    header: {
                        values: columns,
                        align: 'left',
                        fill: { color: 'lightblue' },
                        font: { size: 12, color: 'black' }
                    },
                    cells: {
                        values: values,
                        align: 'left',
                        fill: { color: 'lightgrey' },
                        font: { size: 11, color: 'black' }
                    }
                }],
                layout: {
                    title: { text: title, x: 0.5 }
                }
            };

            Plotly.newPlot('table-container', fig.data, fig.layout);
        }
    </script>
</body>
</html>
